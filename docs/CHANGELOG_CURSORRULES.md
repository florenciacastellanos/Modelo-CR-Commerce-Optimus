# Changelog - .cursorrules

**Version actual:** 5.15
**Last Updated:** 19 Febrero 2026

---

- **v5.15**: Optimizaci√≥n estructural del archivo `.cursorrules`
  - Changelog movido a archivo dedicado (`docs/CHANGELOG_CURSORRULES.md`)
  - Secci√≥n An√°lisis Comparativo v3.0 condensada (detalle en `docs/GUIA_ANALISIS_COMPARATIVO_v3.md`)
  - ERROR 9 condensado (detalle en `docs/GOLDEN_TEMPLATES.md` y `docs/CHANGELOG_v6.3.8.md`)
  - Secci√≥n Jerarqu√≠a de Documentaci√≥n eliminada (cubierta por Referencias R√°pidas)
  - Reducci√≥n de ~195 l√≠neas sin cambios funcionales
- **v5.14**: Protocolo de primer mensaje reforzado (REGLA #0)
  - Regla de saludo movida al inicio absoluto del archivo (l√≠neas 1-3)
  - Lista expl√≠cita de triggers (saludos, mensajes vagos, primer mensaje)
  - Anti-patr√≥n documentado con ejemplo de error vs correcto
  - Refuerzo al final del archivo (recordatorio)
  - Archivo dedicado `.cursor/rules/greeting-protocol.md` con `alwaysApply: true`
- **v5.13**: ‚≠ê **NUEVO** Integraci√≥n con repo complementario de Variables Duras de Negocio
  - **Nueva Opci√≥n 5 (Variables de negocio)** en deep dive POST-ENTREGA:
    - Verifica variables disponibles en `../commerce_xm-cr-business-vars/` para el Commerce Group/proceso analizado
    - Normaliza nombres v√≠a `process_aliases.yml`, busca disponibilidad en `process_registry.yml`
    - Sugiere variables al usuario con nombre y descripci√≥n antes de ejecutar
    - Renderiza `.sql` con par√°metros del an√°lisis CR en curso y ejecuta v√≠a `bq query`
    - Mapea filtros disponibles por tabla fuente (`available_filters` del `.yml`)
    - Complementa el deep dive est√°ndar, no lo reemplaza
  - **Opci√≥n Cross-site** renombrada a Opci√≥n 6 (sin cambios funcionales)
  - **Formato de salida**: Opci√≥n 5 se muestra condicionalmente (solo si hay variables configuradas)
  - **Referencias R√°pidas**: Agregada fila para repo de variables duras
  - **Refs:** `../commerce_xm-cr-business-vars/.cursorrules` y `../commerce_xm-cr-business-vars/docs/02_agent_playbook.md`
- **v5.12**: ‚≠ê **ACTUALIZADO** POST-ENTREGA: Definiciones completas para Deep Dive Adicional
  - **6 definiciones implementadas**:
    1. **Recursividad**: Una sola ronda de deep dive. Despu√©s de entregar, NO se re-ofrece
    2. **Naming**: Archivo con mismo nombre + `_deep_dive` (ej: `reporte_cr_pdd_mla_..._deep_dive.html`)
    3. **Elemento espec√≠fico**: SIEMPRE preguntar al usuario en qu√© dimensi√≥n profundizar (nunca asumir)
    4. **Temporal**: SIEMPRE preguntar al usuario qu√© quiere muestrear/analizar
    5. **Cross-site**: NO SOPORTADO ‚Äî informar al usuario que debe iniciar an√°lisis nuevo
    6. **Muestreo adicional**: Muestra fresca (re-muestreo de cero con N ampliado, no incremental)
  - **4 opciones de deep dive** (cross-site eliminado): Nueva dimensi√≥n, Elemento espec√≠fico, Muestrear conversaciones adicionales, Temporal
  - **Regla general**: Cuando algo no est√° definido ‚Üí PREGUNTAR al usuario antes de ejecutar
  - **Output**: Siempre HTML v6.3.8 completo (cuantitativo + conversacional)
  - **Consultas obligatorias** por opci√≥n documentadas en detalle
- **v5.11**: POST-ENTREGA: Oferta de Deep Dive Adicional (OBLIGATORIO)
  - Paso POST-ENTREGA inicial con 5 opciones (incluyendo cross-site, luego removido como opci√≥n activa en v5.12)
  - Contexto din√°mico y reglas base
  - **Ref:** `docs/METODOLOGIA_5_FASES.md#post-entrega`
- **v5.10**: ‚≠ê **NUEVO** Muestreo por CONTRIB_ABS v6.4.9
  - **Cambio cr√≠tico en l√≥gica de muestreo**: Ahora proporcional a **CONTRIB_ABS** (contribuci√≥n % a variaci√≥n de CR)
  - **ANTES**: `muestreo = |VAR_CR| √ó Incoming` ‚Üí Sesgo hacia elementos con alto incoming
  - **AHORA**: `muestreo = CONTRIB_ABS` ‚Üí Proporcional al impacto real en variaci√≥n de CR
  - **Ejemplo**: Si REPENTANT_BUYER tiene 32.9% CONTRIB_ABS y DEFECTIVE_ITEM tiene 20.6%, el muestreo asigna ~32.9% y ~20.6% del presupuesto respectivamente
  - **Mantiene**: M√≠nimo 20 conversaciones por elemento-per√≠odo, 70% picos + 30% normales
  - **Beneficio**: Mayor correlaci√≥n entre muestreo y an√°lisis de impacto en CR
- **v5.9**: Columnas de Contribuci√≥n en Tabla de Causas Ra√≠z v6.4.8
- **v5.8**: ‚≠ê **NUEVO** Frecuencia Real de Muestra + Ordenamiento por % P2 (v6.4.5)
  - **Columna CASOS**: Ahora muestra frecuencia real de conversaciones testeadas (no proporcional)
  - **Ordenamiento de patrones**: Por **% de aparici√≥n en P2** (per√≠odo m√°s reciente)
    - Patrones con mayor participaci√≥n en P2 aparecen primero
    - Refleja la situaci√≥n actual de los contactos
  - Archivos modificados:
    - `scripts/generar_analisis_comparativo_desde_separados.py`
    - `config/causas_sinonimos.py`
    - `generar_reporte_cr_universal_v6.3.6.py`
  - Aplica autom√°ticamente a todos los reportes futuros
- **v5.7a**: Sistema de Sin√≥nimos con Auto-Aprendizaje (v6.4.3)
  - **Consolidaci√≥n de Causas Ra√≠z**: Detecta y unifica causas sem√°nticamente equivalentes
    - M√©todo 1: Diccionario semilla con 8 grupos de causas conocidas
    - M√©todo 2: Similaridad de texto (SequenceMatcher >= 80% auto-confirma)
    - M√©todo 3: Palabras comunes significativas (>= 2 + 65% similaridad)
    - M√©todo 4: Detecci√≥n por palabras clave tem√°ticas
  - **Auto-Aprendizaje**: Sistema que se retroalimenta
    - Detecta nuevas similitudes durante an√°lisis
    - Auto-confirma (score >= 80%) o marca pendientes para revisi√≥n
    - Biblioteca persistente en `config/causas_biblioteca_aprendida.json`
  - **Archivos nuevos**:
    - `config/causas_sinonimos.py` - M√≥dulo principal con l√≥gica de consolidaci√≥n
    - `config/causas_biblioteca_aprendida.json` - Biblioteca de aprendizaje
    - `docs/SISTEMA_SINONIMOS.md` - Documentaci√≥n completa
  - **Integraci√≥n**: `generar_analisis_comparativo_desde_separados.py` usa consolidaci√≥n autom√°ticamente
  - **Ref:** `docs/SISTEMA_SINONIMOS.md`
- **v5.7b**: Columnas de Contribuci√≥n en Tabla de Causas Ra√≠z v6.4.8
  - **Nuevas columnas en tabla de causas ra√≠z**:
    - **Contrib Œî**: Contribuci√≥n de cada causa a la variaci√≥n total de casos de la apertura
      - F√≥rmula: `(VAR CASOS causa / VAR CASOS total) √ó 100`
    - **Contrib CR**: Contribuci√≥n al cambio de CR del Commerce Group completo
      - F√≥rmula: `Contrib Œî √ó (Contribuci√≥n de la apertura al CR total) / 100`
  - **Fila TOTAL**: Muestra 100% en Contrib Œî y la contribuci√≥n total de la apertura en Contrib CR
  - **Aplicado a los 3 bloques** de generaci√≥n de tablas de an√°lisis comparativo
  - **Estilo visual**: Contrib CR en color Meli azul (#3483FA) para destacar m√©trica clave
- **v5.6**: Eventos Comerciales v6.4.2 + Hallazgo Principal v6.4.1
  - **Hallazgo Principal (v6.4.1)**: Secci√≥n autom√°tica post-Resumen Ejecutivo con interpretaci√≥n de negocio
    - Detecta temporalidad (post-temporada alta, Hot Sale, etc.)
    - Analiza variaci√≥n de incoming y direcci√≥n del CR
    - Integra causas ra√≠z del an√°lisis de conversaciones
    - Menciona eventos comerciales relevantes autom√°ticamente
  - **Eventos Comerciales (v6.4.2)**: Sistema h√≠brido completo
    - Prioridad 1: Hard Metrics pre-calculadas (.parquet)
    - Prioridad 2: Query fallback on-the-fly (LK_MKP_PROMOTIONS_EVENT)
    - Tabla comparativa P1 vs P2 con delta de casos
    - Iconos por tipo de evento (üõí Black Friday, üéÑ Navidad, üî• Hot Sale)
    - Badges visuales (positivo/negativo/neutral)
    - Integraci√≥n autom√°tica en Hallazgo Principal
    - CSS dedicado con dise√±o visual mejorado
    - Footer t√©cnico actualizado con metadata de eventos
- **v5.5**: Cards Colapsables v6.4.0 para An√°lisis Comparativo
  - Cada elemento de apertura (CDU, PROCESO, TIPIFICACION, etc.) se presenta en una card colapsable
  - Cards ordenadas por **contribuci√≥n a la variaci√≥n de CR** (mayor impacto primero)
  - Ranking visual (#1, #2, #3 con estilo especial para Top 3)
  - Badges din√°micos: contribuci√≥n %, variaci√≥n de casos, total conversaciones
  - Botones "Expandir todas" / "Colapsar todas" para navegaci√≥n r√°pida
  - Primera card expandida por defecto
  - Funcionalidad universal: aplica a cualquier apertura (CDU, PROCESO, TIPIFICACION, etc.)
  - Los 3 bloques de generaci√≥n de an√°lisis comparativo actualizados para consistencia
- **v5.4**: ‚≠ê **NUEVO** ERROR 9: Formato Obligatorio de Reporte v6.3.8
  - Todo reporte DEBE generarse con el script oficial
  - Checklist obligatorio de 8 componentes pre-entrega
  - Prohibici√≥n expl√≠cita de generar HTML ad-hoc
  - Componentes obligatorios documentados en tabla
  - Ref: `docs/CHANGELOG_v6.3.8.md`
- **v5.3**: An√°lisis Comparativo v3.0 (detecci√≥n real de patrones por per√≠odo)
  - Prompt comparativo con conversaciones de ambos per√≠odos
  - Detecci√≥n de patrones: PERSISTENTE / NUEVO / DESAPARECE
  - M√°ximo 4-5 causas ra√≠z priorizadas por impacto
  - Porcentajes reales (no proporcionales)
  - Elimina sesgo de divisi√≥n proporcional del v2.0
  - Scripts: `generar_analisis_comparativo_directo.py` + adaptador v3‚Üív2
  - Documentaci√≥n detallada movida a `/docs`:
    - `docs/REGLAS_CRITICAS_DETALLADAS.md` (8 errores explicados)
    - `docs/METODOLOGIA_5_FASES.md` (flujo completo)
    - `docs/INTERPRETACION_AUTOMATICA.md` (mapeo autom√°tico)
    - `docs/PROTOCOLO_CURSOR_AI.md` (flujo v6.3.6)
    - `docs/GUIA_ANALISIS_COMPARATIVO_v3.md` (an√°lisis comparativo)
  - Optimizaci√≥n: 1,139 l√≠neas ‚Üí ~510 l√≠neas (55% reducci√≥n, 0% p√©rdida info)
- v5.2: Actualizado a template v6.3.6 (espera autom√°tica para an√°lisis)
- v5.1: Actualizado a template v6.3.4 (robustez universal)
- v5.0: Checklist ejecutable + reducci√≥n de "cr√≠ticos" de 36 a 8 + estructura optimizada
